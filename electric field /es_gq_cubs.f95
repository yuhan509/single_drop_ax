SUBROUTINE es_gq_gax(func,i,ai,bi,j,i0,ss)
IMPLICIT NONE
DOUBLE PRECISION,EXTERNAL :: func
DOUBLE PRECISION,INTENT(IN) :: ai,bi !integral range
INTEGER,INTENT(IN) :: i0,j,i
DOUBLE PRECISION,INTENT(OUT) :: ss
INTEGER :: k
INTEGER,PARAMETER :: m=5
DOUBLE PRECISION :: dx,xr,xm,w(m),x(m) 

!x = (/0.048307665687738316235d0,&
!0.144471961582796493485d0,&
!0.239287362252137074545d0,&
!0.331868602282127649780d0,&
!0.421351276130635345364d0,&
!0.506899908932229390024d0,&
!0.587715757240762329041d0,&
!0.663044266930215200975d0,&
!0.732182118740289680387d0,&
!0.794483795967942406963d0,&
!0.849367613732569970134d0,&
!0.896321155766052123965d0,&
!0.934906075937739689171d0,&
!0.964762255587506430774d0,&
!0.985611511545268335400d0,&
!0.997263861849481563545d0/)
!w = (/0.096540088514727800567d0,&
!0.095638720079274859419d0,&
!0.093844399080804565639d0,&
!0.091173878695763884713d0,&
!0.087652093004403811143d0,&
!0.083311924226946755222d0,&
!0.078193895787070306472d0,&
!0.072345794108848506225d0,&
!0.065822222776361846838d0,&
!0.058684093478535547145d0,&
!0.050998059262376176196d0,&
!0.042835898022226680657d0,&
!0.034273862913021433103d0,&
!0.025392065309262059456d0,&
!0.016274394730905670605d0,&
!0.007018610009470096600d0/)
!
!x = (/.095012509837637440185d0,.281603550779258913230d0,&
!.458016777657227586342d0,.617876244402643748447d0,&
!.755404408355003033895d0,.865631202387831743880d0,&
!.944575023073232576078d0,.989400934991649932596d0/)
!w = (/.189450610455068496285d0,.182603415044923588867d0,&
!.169156519395002538189d0,.149595988816576732081d0,&
!.124628971255533872052d0,.095158511682492784810d0,&
!.062253523938647892863d0,.027152459411754094852d0/)
!
w = (/.2955242247d0,.2692667193d0,.2190863625d0,.1494513491d0,.0666713443d0/)
x = (/.1488743389d0,.4333953941d0,.6794095682d0,.8650633666d0,.9739065285d0/)
!
!x=(/.339981d0, .861136d0 /)
!w=(/.652145d0, .347855d0 /)
!
!x=(/.577350269189626d0/)
!w=(/1d0/)

ss = 0d0
xr = (bi-ai)*.5d0
xm = (bi+ai)*.5d0
Do k=1,m
    dx = xr * x(k)
    ss = ss + w(k)*(func(j,i0,i,xm+dx)+func(j,i0,i,xm-dx))
ENDDO
ss = ss*xr
!write(*,*) "regular_gauss xr",xr
END SUBROUTINE


SUBROUTINE es_gq_gax_o(func,i,ai,bi,j,i0,ss)
!! a and b are the lower and upper borders, a=i,b=i+1
USE mod_GAUSSQxw   

IMPLICIT NONE
DOUBLE PRECISION,EXTERNAL :: func
DOUBLE PRECISION,INTENT(IN) :: ai,bi !integral range
INTEGER,INTENT(IN) :: i0,i,j
! i for ith element
DOUBLE PRECISION,INTENT(OUT) :: ss
INTEGER :: k
DOUBLE PRECISION :: xr,xm,dx 

ss = 0d0
xr = (bi-ai)*.5d0
xm = (bi+ai)*.5d0
!Do k=1,eqm
!    dx = xr * eqx(k)
!    ss = ss + eqw(k)*func(j,i0,i,k,xm+dx)
!ENDDO
Do k=1,qm
    dx = xr * qx(k)
    ss = ss + qw(k)*func(j,i0,i,k,xm+dx)
ENDDO
ss = ss*xr
!write(*,*) "regular_gauss xr",xr
END SUBROUTINE


SUBROUTINE es_gq_dgdnax_o(func,i,ai,bi,i0,ss)
!! a and b are the lower and upper borders, a=i,b=i+1
USE mod_GAUSSQxw   

IMPLICIT NONE
DOUBLE PRECISION,EXTERNAL :: func
DOUBLE PRECISION,INTENT(IN) :: ai,bi !integral range
INTEGER,INTENT(IN) :: i0,i!,j
! i for ith element
DOUBLE PRECISION,INTENT(OUT) :: ss
INTEGER :: k
DOUBLE PRECISION :: xr,xm,dx 

ss = 0d0
xr = (bi-ai)*.5d0
xm = (bi+ai)*.5d0
!Do k=1,eqm
!    dx = xr * eqx(k)
!    ss = ss + eqw(k)*func(i0,i,k,xm+dx)
!ENDDO
Do k=1,qm
    dx = xr * qx(k)
    ss = ss + qw(k)*func(i0,i,k,xm+dx)
ENDDO
ss = ss*xr
!write(*,*) "regular_gauss xr",xr
END SUBROUTINE


SUBROUTINE es_gq_dgdnax(func,i,ai,bi,i0,ss)
IMPLICIT NONE
DOUBLE PRECISION,EXTERNAL :: func
DOUBLE PRECISION,INTENT(IN) :: ai,bi !integral range
INTEGER,INTENT(IN) :: i0,i
DOUBLE PRECISION,INTENT(OUT) :: ss
INTEGER :: k
INTEGER,PARAMETER :: m=5
DOUBLE PRECISION :: dx,xr,xm,w(m),x(m) 

!x = (/0.048307665687738316235d0,&
!0.144471961582796493485d0,&
!0.239287362252137074545d0,&
!0.331868602282127649780d0,&
!0.421351276130635345364d0,&
!0.506899908932229390024d0,&
!0.587715757240762329041d0,&
!0.663044266930215200975d0,&
!0.732182118740289680387d0,&
!0.794483795967942406963d0,&
!0.849367613732569970134d0,&
!0.896321155766052123965d0,&
!0.934906075937739689171d0,&
!0.964762255587506430774d0,&
!0.985611511545268335400d0,&
!0.997263861849481563545d0/)
!w = (/0.096540088514727800567d0,&
!0.095638720079274859419d0,&
!0.093844399080804565639d0,&
!0.091173878695763884713d0,&
!0.087652093004403811143d0,&
!0.083311924226946755222d0,&
!0.078193895787070306472d0,&
!0.072345794108848506225d0,&
!0.065822222776361846838d0,&
!0.058684093478535547145d0,&
!0.050998059262376176196d0,&
!0.042835898022226680657d0,&
!0.034273862913021433103d0,&
!0.025392065309262059456d0,&
!0.016274394730905670605d0,&
!0.007018610009470096600d0/)
!
!x = (/.095012509837637440185d0,.281603550779258913230d0,&
!.458016777657227586342d0,.617876244402643748447d0,&
!.755404408355003033895d0,.865631202387831743880d0,&
!.944575023073232576078d0,.989400934991649932596d0/)
!w = (/.189450610455068496285d0,.182603415044923588867d0,&
!.169156519395002538189d0,.149595988816576732081d0,&
!.124628971255533872052d0,.095158511682492784810d0,&
!.062253523938647892863d0,.027152459411754094852d0/)
!
w = (/.2955242247d0,.2692667193d0,.2190863625d0,.1494513491d0,.0666713443d0/)
x = (/.1488743389d0,.4333953941d0,.6794095682d0,.8650633666d0,.9739065285d0/)
!
!x=(/.339981d0, .861136d0 /)
!w=(/.652145d0, .347855d0 /)
!
!x=(/.577350269189626d0/)
!w=(/1d0/)

ss = 0d0
xr = (bi-ai)*.5d0
xm = (bi+ai)*.5d0
Do k=1,m
    dx = xr * x(k)
    ss = ss + w(k)*(func(i0,i,xm+dx)+func(i0,i,xm-dx))
ENDDO
ss = ss*xr
!write(*,*) "regular_gauss xr",xr
END SUBROUTINE
